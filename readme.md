# üõ† –î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ: –°–∫—Ä–∏–ø—Ç –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å—Ç—Ä–æ–∫

## üìå –¶–µ–ª—å

–°–æ–∑–¥–∞—Ç—å Bash-—Å–∫—Ä–∏–ø—Ç, –∫–æ—Ç–æ—Ä—ã–π:
- –°–æ–∑–¥–∞—ë—Ç –ø–∞–ø–∫—É `/opt/app`, –µ—Å–ª–∏ –µ—ë –Ω–µ—Ç
- –°–æ–∑–¥–∞—ë—Ç —Ñ–∞–π–ª `/opt/app/log.txt`, –µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç
- –ö–∞–∂–¥—ã–µ 17 —Å–µ–∫—É–Ω–¥ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –≤ —Ñ–∞–π–ª —Å–ª—É—á–∞–π–Ω—É—é —Å—Ç—Ä–æ–∫—É –¥–ª–∏–Ω–æ–π –æ—Ç 1 –¥–æ 20 —Å–∏–º–≤–æ–ª–æ–≤
(*–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ*) –î–æ–±–∞–≤–∏—Ç—å –≤ –∞–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫—É
(*–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ*) –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Ä–æ—Ç–∞—Ü–∏—é log-—Ñ–∞–π–ª–∞ —Å –ø–æ–º–æ—â—å—é logrotate

---

##  1. –°–æ–∑–¥–∞–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–∞

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –¥–æ–º–∞—à–Ω—é—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é:
   ```bash
   cd /home/alex
   ```

2. –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `task3.sh`:
   ```bash
   nano task3.sh
   ```

3. –í—Å—Ç–∞–≤—å—Ç–µ —Å–ª–µ–¥—É—é—â–∏–π –∫–æ–¥:

   ```bash
   #!/bin/bash

   if test -d "/opt/app"; then
       echo "–ü–∞–ø–∫–∞ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç. –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Å–æ–∑–¥–∞–Ω–∏–µ .."
   else
       echo "–°–æ–∑–¥–∞–Ω–∏–µ –ø–∞–ø–∫–∏ app"
       mkdir /opt/app
       echo "–ü–∞–ø–∫–∞ —Å–æ–∑–¥–∞–Ω–∞."
   fi

   if test -f "/opt/app/log.txt"; then
       echo "–§–∞–π–ª —Å—É—â–µ—Å—Ç–≤—É–µ—Ç. –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Å–æ–∑–¥–∞–Ω–∏–µ .."
   else
       echo "–°–æ–∑–¥–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ log.txt"
       touch /opt/app/log.txt
       echo "–§–∞–π–ª —Å–æ–∑–¥–∞–Ω."
   fi

   while true; do
        number=$(shuf -i 1-20 -n 1)
        string=$(tr -dc '[:graph:]' </dev/urandom | head -c $number)
        echo "$string" >> /opt/app/log.txt
        echo "–î–æ–±–∞–≤–ª–µ–Ω–∞ —Å—Ç—Ä–æ–∫–∞: $string"
        sleep 17
   done
   ```

4. –°–¥–µ–ª–∞–π—Ç–µ —Å–∫—Ä–∏–ø—Ç –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º:
   ```bash
   chmod +x /home/alex/task3.sh
   ```

---

##  2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∏ —á–µ—Ä–µ–∑ `systemd`

1. –°–æ–∑–¥–∞–π—Ç–µ unit-—Ñ–∞–π–ª:
   ```bash
   sudo nano /etc/systemd/system/start_script_task3.service
   ```

2. –í—Å—Ç–∞–≤—å—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ:

   ```ini
   [Unit]
   Description=–ó–∞–ø—É—Å–∫ —Å–∫—Ä–∏–ø—Ç–∞ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ —Å–∏—Å—Ç–µ–º—ã
   After=network.target

   [Service]
   ExecStart=/home/alex/task3.sh
   Restart=on-failure
   Type=simple

   [Install]
   WantedBy=multi-user.target
   ```

3. –û–±–Ω–æ–≤–∏—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é systemd:
   ```bash
   sudo systemctl daemon-reexec
   ```

4. –í–∫–ª—é—á–∏—Ç–µ –∞–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫—É:
   ```bash
   sudo systemctl enable task3.service
   ```

5. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –≤—Ä—É—á–Ω—É—é (–¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏):
   ```bash
   sudo systemctl start task3.service
   ```

6. –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ —Å—Ç–∞—Ç—É—Å:
   ```bash
   sudo systemctl status task3.service
   ```

---

## 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–æ—Ç–∞—Ü–∏–∏ –ª–æ–≥–æ–≤ —Å –ø–æ–º–æ—â—å—é logrotate

1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `logrotate` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω:
   ```bash
   sudo apt install logrotate
   ```

2. –°–æ–∑–¥–∞–π—Ç–µ –∫–æ–Ω—Ñ–∏–≥ –¥–ª—è –ª–æ–≥–æ–≤:
   ```bash
   sudo nano /etc/logrotate.d/task3
   ```

3. –í—Å—Ç–∞–≤—å—Ç–µ —Å–ª–µ–¥—É—é—â–µ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ(–±–µ–∑ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤, —Ä—É–≥–∞–µ—Ç—Å—è –Ω–∞ –Ω–∏—Ö):

   ```conf
   /opt/app/log.txt {
       daily              # —Ä–æ—Ç–∞—Ü–∏—è –∫–∞–∂–¥—ã–π –¥–µ–Ω—å
       rotate 7           # —Ö—Ä–∞–Ω–∏—Ç—å 7 —Ñ–∞–π–ª–æ–≤: log.txt.1 ... log.txt.7
       compress           # —Å–∂–∏–º–∞—Ç—å —Å—Ç–∞—Ä—ã–µ —Ñ–∞–π–ª—ã (gzip)
       missingok          # –Ω–µ —Ä—É–≥–∞—Ç—å—Å—è, –µ—Å–ª–∏ —Ñ–∞–π–ª–∞ –Ω–µ—Ç
       notifempty         # –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å, –µ—Å–ª–∏ —Ñ–∞–π–ª –ø—É—Å—Ç–æ–π
       copytruncate       # –æ–±—Ä–µ–∑–∞—Ç—å —Ç–µ–∫—É—â–∏–π —Ñ–∞–π–ª, –Ω–µ –ø—Ä–µ—Ä—ã–≤–∞—è –∑–∞–ø–∏—Å—å (–≤–∞–∂–Ω–æ –¥–ª—è —Ç–≤–æ–µ–≥–æ —Å–∫—Ä–∏–ø—Ç–∞!)
   }
   ```

4. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –≤—Ä—É—á–Ω—É—é:
   ```bash
   sudo logrotate -f /etc/logrotate.d/task3
   ls -lh /opt/app/log.txt*
   ```
### –ü–æ—á–µ–º—É copytruncate –≤–∞–∂–Ω–æ?
–¢–≤–æ–π —Å–∫—Ä–∏–ø—Ç –≤–µ—á–Ω–æ –ø–∏—à–µ—Ç –≤ log.txt. –ë–µ–∑ —ç—Ç–æ–π –æ–ø—Ü–∏–∏ logrotate –ø–µ—Ä–µ–∏–º–µ–Ω—É–µ—Ç —Ñ–∞–π–ª, –∞ —Å–∫—Ä–∏–ø—Ç –±—É–¥–µ—Ç –ø–∏—Å–∞—Ç—å –≤ —Å—Ç–∞—Ä—ã–π, –±–æ–ª—å—à–µ –Ω–µ–æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º—ã–π —Ñ–∞–π–ª. copytruncate —Ä–µ—à–∞–µ—Ç —ç—Ç–æ: –æ–Ω –∫–æ–ø–∏—Ä—É–µ—Ç —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –∏ –æ–±–Ω—É–ª—è–µ—Ç —Ç–µ–∫—É—â–∏–π —Ñ–∞–π–ª, –Ω–µ —Ç—Ä–æ–≥–∞—è —Ñ–∞–π–ª–æ–≤—ã–π –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä.
---

## –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

| –ö–æ–º–∞–Ω–¥–∞                                  | –û–ø–∏—Å–∞–Ω–∏–µ                          |
|------------------------------------------|-----------------------------------|
| `sudo systemctl start start_script_task3.service`     | –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–∞                    |
| `sudo systemctl stop start_script_task3.service`      | –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–µ—Ä–≤–∏—Å–∞                 |
| `sudo systemctl restart start_script_task3.service`   | –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–∞                |
| `sudo systemctl status start_script_task3.service`    | –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞                  |
| `sudo journalctl -u start_script_task3.service`       | –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ —Å–µ—Ä–≤–∏—Å–∞            |
| `tail -f /opt/app/log.txt`                            | –ù–∞–±–ª—é–¥–µ–Ω–∏–µ –∑–∞ –ª–æ–≥–æ–º –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ |

---

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–∏—Å–∞ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ `/opt/app/log.txt`. –í –Ω—ë–º –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É –¥–æ–ª–∂–Ω–∞ –ø–æ—è–≤–ª—è—Ç—å—Å—è —Å–ª—É—á–∞–π–Ω–∞—è —Å—Ç—Ä–æ–∫–∞.

```bash
tail -f /opt/app/log.txt
```

–¢–∞–∫–∂–µ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ, —Å–æ–∑–¥–∞—é—Ç—Å—è –ª–∏ –∞—Ä—Ö–∏–≤—ã:
```bash
ls -lh /opt/app/log.txt*
```

---
